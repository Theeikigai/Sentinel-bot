const { SlashCommandBuilder } = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('delete_tournament')
    .setDescription('Delete the tournament and clean up associated channels and roles')
    .addStringOption(option =>
      option.setName('tournament_id')
        .setDescription('The unique ID of the tournament to delete')
        .setRequired(true))
    .setDefaultMemberPermissions(PermissionFlagsBits.Administrator),

  async execute(interaction) {
    const tournamentId = interaction.options.getString('tournament_id');
    const tournament = tournaments[tournamentId];

    if (!tournament) {
      return interaction.reply({ content: `Tournament with ID ${tournamentId} not found.`, ephemeral: true });
    }

    // Call the cleanup function to delete the tournament
    await this.deleteTournament(interaction, tournamentId);

    return interaction.reply({ content: `Tournament with ID ${tournamentId} has been deleted and cleaned up successfully.`, ephemeral: true });
  },

  // Function to delete the tournament and its associated channels and roles
  async deleteTournament(interaction, tournamentId) {
    const tournament = tournaments[tournamentId];
    
    // Delete the announcement channel
    const announcementChannel = await interaction.guild.channels.fetch(tournament.announcementChannel);
    if (announcementChannel) await announcementChannel.delete();

    // Delete all match threads
    for (const threadId of tournament.threads) {
      const thread = await interaction.guild.channels.fetch(threadId);
      if (thread) await thread.delete();
    }